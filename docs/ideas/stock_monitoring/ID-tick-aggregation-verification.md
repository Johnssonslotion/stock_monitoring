# IDEA: Tick Aggregation Verification Strategy (1m Cross Check)

**Status**: ğŸŒ¿ Sprouting (Drafting)
**Priority**: P1 (Data Integrity)
**Related**: `ISSUE-044`, `RFC-008`, `RFC-009`

## 1. ê°œìš” (Abstract)
**"í‹±ì´ ì—†ìœ¼ë©´ ë¶„ë´‰ë„ ì—†ë‹¤."**
TimescaleDB Continuous Aggregates ë„ì…ìœ¼ë¡œ í‹± ë°ì´í„°ê°€ ë¶„ë´‰ìœ¼ë¡œ ìë™ ë³€í™˜ë˜ì§€ë§Œ, ë§Œì•½ **ìˆ˜ì§‘ ë‹¨ê³„ì—ì„œ í‹± ìì²´ê°€ ëˆ„ë½ë˜ì—ˆë‹¤ë©´** ì˜ëª»ëœ ë¶„ë´‰(Data Gap or Partial Bar)ì´ ìƒì„±ë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.
ë³¸ ì•„ì´ë””ì–´ëŠ” **ì¥ ë§ˆê° í›„(Post-Market)**, `Tick-Derived Candles`(View)ì™€ `Broker API Candles`(Source)ë¥¼ êµì°¨ ê²€ì¦í•˜ì—¬ ë°ì´í„° ì™„ì „ì„±ì„ ë³´ì¥í•˜ëŠ” ì „ëµì…ë‹ˆë‹¤.

## 2. ê°€ì„¤ ë° ê¸°ëŒ€ íš¨ê³¼ (Hypothesis & Impact)
- **ê°€ì„¤**: í‹± ë°ì´í„°ê°€ 100% ì™„ì „í•˜ë‹¤ë©´, í‹±ì„ ì§‘ê³„í•œ OHLCVëŠ” ë¸Œë¡œì»¤ê°€ ì œê³µí•˜ëŠ” 1ë¶„ë´‰ OHLCVì™€ (ì˜¤ì°¨ ë²”ìœ„ ë‚´ì—ì„œ) ì¼ì¹˜í•´ì•¼ í•œë‹¤.
- **ê¸°ëŒ€ íš¨ê³¼**:
    - **Hidden Gap Detection**: ìˆ˜ì§‘ê¸°ëŠ” ì •ìƒì´ì—ˆìœ¼ë‚˜ ë°ì´í„°ê°€ ë¹„ì—ˆë˜ êµ¬ê°„ íƒì§€.
    - **Backtest Confidence**: ê²€ì¦ëœ(Verified) ë°ì´í„°ë§Œ ë°±í…ŒìŠ¤íŒ…ì— í™œìš©.
    - **Automated Recovery Trigger**: ë¶ˆì¼ì¹˜ êµ¬ê°„ ë°œê²¬ ì‹œ ìë™ìœ¼ë¡œ REST API ë°±í•„ íŠ¸ë¦¬ê±°.

## 3. êµ¬ì²´í™” ì„¸ì…˜ (Elaboration - Council of Six)

### ğŸ‘” PM (Project Manager)
> "ì‚¬ìš©ìë‹˜ì˜ ìš”êµ¬ì‚¬í•­ì€ ëª…í™•í•©ë‹ˆë‹¤. 'ê°€ëŠ¥í•œ í•œ í‹±(Tick)ì„ ì‚´ë ¤ë¼(Recover)', ê·¸ëŸ¬ë‚˜ 'ë¶ˆê°€ëŠ¥í•˜ë©´ ì¿¨í•˜ê²Œ ë¡œê·¸ë§Œ ë‚¨ê²¨ë¼(Log)'ì…ë‹ˆë‹¤. í˜„ì¬ ìŠ¤í™ì´ 'ìµì¼ 10:30'ìœ¼ë¡œ ë˜ì–´ ìˆì–´ 'ë‹¹ì¼ ë³µêµ¬' ê³¨ë“ íƒ€ì„ì„ ë†“ì¹˜ê³  ìˆìŠµë‹ˆë‹¤. **ì¥ ë§ˆê° ì§í›„(15:40)**ì— 1ì°¨ë¡œ 'ë‹¹ì¼ë¶„ í‹± ë³µêµ¬'ë¥¼ ì‹œë„í•˜ê³ , ì‹¤íŒ¨ ì‹œ 'ë¡œê·¸ë¥¼ ë‚¨ê¸°ë„ë¡' ìŠ¤ì¼€ì¤„ê³¼ ë¡œì§ì„ ì „ë©´ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤."

### ğŸ›ï¸ Architect
> "ì •í™•í•œ ì§€ì ì…ë‹ˆë‹¤. Tick ë°ì´í„°ëŠ” íœ˜ë°œì„±ì´ ê°•í•´ 'ë‹¹ì¼'ì´ ì§€ë‚˜ë©´ êµ¬í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ë¡œì§ì„ ë¶„ê¸°ì²˜ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.
> 1. **Realtime**: `Queue` ì¦‰ì‹œ ì²˜ë¦¬.
> 2. **Post-Market (Same Day)**: `15:40` ë°°ì¹˜ë¥¼ ëŒë ¤ `gap` ë°œê²¬ ì‹œ `TICK_DATA` ì¡°íšŒ ë° ë³µêµ¬ ì‹œë„.
> 3. **Fallback**: APIì—ì„œ í‹± ë¯¸ì œê³µ ì‹œ(í˜¹ì€ ìµì¼), `market_candles`ë§Œ Upsertí•˜ê³  `market_verification_results`ì— `status=TICKS_UNAVAILABLE`ì„ ì˜êµ¬ ê¸°ë¡."

### ğŸ§ª Data Scientist
> "ë°ì´í„°ì˜ 'ê²°(Resolution)'ì„ ì§€íƒ€ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” í‹± ë°ì´í„°ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì›í•˜ì§€ë§Œ, êµ¬í•  ìˆ˜ ì—†ë‹¤ë©´ 'ë¶„ë´‰ì´ë¼ë„' ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œì´ 'í‹± ëˆ„ë½ë¨(Partial Data)'ì´ë¼ëŠ” ìƒíƒœë¥¼ ëª…í™•íˆ ì¸ì§€í•  ìˆ˜ ìˆë„ë¡, ê°ì‚¬ ë¡œê·¸ì— `TICKS_UNAVAILABLE` í”Œë˜ê·¸ê°€ ë°•íˆëŠ” ê²ƒì´ ë¶„ì„ê°€ ì…ì¥ì—ì„œ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤."

### ğŸ—ï¸ Infra
> "15:40 ì‹¤í–‰ì€ íŠ¸ë˜í”½ì´ ëª°ë¦´ ìˆ˜ ìˆì§€ë§Œ, Queueê°€ ìˆìœ¼ë¯€ë¡œ ê´œì°®ìŠµë‹ˆë‹¤. ë‹¤ë§Œ 'í‹± ë³µêµ¬'ëŠ” API í˜¸ì¶œëŸ‰ì´ ë§ìœ¼ë¯€ë¡œ(ìˆ˜ì²œ ê±´), Rate Limitì— ê±¸ë¦¬ë©´ `DLQ`ë¡œ ë¹ ì§€ì§€ ì•Šê³  'Candle Fallback'ìœ¼ë¡œ ìš°íšŒí•˜ë„ë¡ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì •êµí•˜ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤."

### ğŸ’» Developer
> "í˜„ì¬ ìŠ¤í™ì˜ 'ìµì¼ ì˜¤ì „'ì€ ë„ˆë¬´ ëŠ¦ìŠµë‹ˆë‹¤. `scheduler.py`ë¥¼ ìˆ˜ì •í•˜ì—¬ `15:40`ì— ë‹¹ì¼ì¹˜ ê²€ì¦ì„ ìˆ˜í–‰í•˜ê²Œ í•˜ê² ìŠµë‹ˆë‹¤. `_recover_gap` ë©”ì„œë“œ ë‚´ì—ì„œ KIS Tick API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ, ì¦‰ì‹œ Candle APIë¥¼ í˜¸ì¶œí•˜ì—¬ Upsertí•˜ê³  ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” `try-except-fallback` íŒ¨í„´ì„ ì ìš©í•˜ê² ìŠµë‹ˆë‹¤."

### ğŸ›¡ï¸ QA
> "í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ 3ê°€ì§€ë¡œ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.
> 1. **Happy**: í‹± ë³µêµ¬ ì„±ê³µ.
> 2. **Fallback**: í‹± API ì‹¤íŒ¨ -> ìº”ë“¤ ë³µêµ¬ ì„±ê³µ + ë¡œê·¸ í™•ì¸.
> 3. **Audit**: `market_verification_results`ì— `TICKS_UNAVAILABLE` ìƒíƒœê°’ ê²€ì¦.
> ì´ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ ë°°í¬ ê°€ëŠ¥í•©ë‹ˆë‹¤."

## 4. PMì˜ ìµœì¢… ê²°ì • (Decision)
> "**ìŠ¤í™ ìˆ˜ì • ìŠ¹ì¸ (Revise Spec)**. ì‚¬ìš©ìë‹˜ì˜ 'ë‹¹ì¼ í‹± ë³µêµ¬ ì›ì¹™'ê³¼ 'ëª…ì‹œì  ë¡œê·¸ ìš”êµ¬'ë¥¼ ë°˜ì˜í•˜ì—¬ ìŠ¤í™ì„ ì¬ì‘ì„±í•©ë‹ˆë‹¤.
> - **Schedule**: ìµì¼ 10:30 -> **ë‹¹ì¼ 15:40** ë³€ê²½.
> - **Logic**: í‹± ë³µêµ¬ ìš°ì„  ì‹œë„ -> ì‹¤íŒ¨ ì‹œ Candle Upsert & `TICKS_UNAVAILABLE` ë¡œê·¸ ê¸°ë¡.
> ì´ ë³€ê²½ì‚¬í•­ì„ ì¦‰ì‹œ ë¬¸ì„œì— ë°˜ì˜í•˜ê³  êµ¬í˜„í•˜ì‹­ì‹œì˜¤."

## 4. ë¡œë“œë§µ ì—°ë™ ì‹œë‚˜ë¦¬ì˜¤
- **Pillar 2 (Data Ingestion)**: Quality Guardrail í•­ëª©ìœ¼ë¡œ ì¶”ê°€.
- **Feature**: `src/verification/cross_validator.py` êµ¬í˜„.
