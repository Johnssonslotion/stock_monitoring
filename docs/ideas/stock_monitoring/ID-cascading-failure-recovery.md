# IDEA: Cascading Failure Recovery (ì¥ì•  ì „íŒŒ ë³µêµ¬ ìë™í™”)

**Status**: ğŸ’¡ Seed (Idea)
**Priority**: P1
**Category**: Infrastructure
**Source**: User (2026-01-22)

---

## 1. ê°œìš” (Abstract)

í˜„ì¬ ì‹œìŠ¤í…œì€ `recovery-worker`, `redis-gatekeeper`, `Collector(kis/kiwoom)`ê°€ ê°œë³„ì ìœ¼ë¡œ ì¥ì• ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìœ¼ë‚˜, 
**ì¥ì•  ì „íŒŒ(Cascading Failure)**ì— ëŒ€í•œ ì²´ê³„ì ì¸ ë³µêµ¬ ì „ëµì´ ë¶€ì¬í•©ë‹ˆë‹¤.

### ë¬¸ì œ ì •ì˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ ë§¤íŠ¸ë¦­ìŠ¤                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì¥ì•  ëª¨ë“ˆ    â”‚ ì˜í–¥ ë²”ìœ„                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Collector   â”‚ ì‹¤ì‹œê°„ í‹± ìˆ˜ì§‘ ì¤‘ë‹¨ â†’ ë°ì´í„° ê°­ ë°œìƒ            â”‚
â”‚ recovery    â”‚ ê°­ ë³µêµ¬ ë¶ˆê°€ â†’ ë°ì´í„° ë¶ˆì™„ì „ì„± ëˆ„ì              â”‚
â”‚ redis-gate  â”‚ Rate Limit í†µì œ ë¶ˆê°€ â†’ 429 ì—ëŸ¬ â†’ ì™¸ë¶€ ì œì¬    â”‚
â”‚ redis (main)â”‚ í‹± ë²„í¼ë§ ì‹¤íŒ¨ â†’ ëŒ€ëŸ‰ ë°ì´í„° ìœ ì‹¤               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ê°€ì„¤ ë° ê¸°ëŒ€ íš¨ê³¼ (Hypothesis & Impact)

### ê°€ì„¤
1. Dockerì˜ `restart: always` ì •ì±…ë§Œìœ¼ë¡œëŠ” **ì˜ì¡´ì„± ìˆœì„œ**ë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ìŒ
2. `Collector` ì¥ì•  ì‹œ `recovery-worker`ê°€ **ì¦‰ì‹œ ì¸ì§€í•˜ê³  ê°­ ë³µêµ¬ë¥¼ ì‹œì‘**í•´ì•¼ í•¨
3. `redis-gatekeeper` ì¥ì•  ì‹œ **ì•ˆì „ ëª¨ë“œ(Fallback)**ë¡œ ì „í™˜í•˜ì—¬ 429 ë°©ì§€ í•„ìš”

### ê¸°ëŒ€ íš¨ê³¼
| í•­ëª© | í˜„ì¬ | ëª©í‘œ |
|------|------|------|
| ìˆ˜ì§‘ê¸° ì¥ì•  ê°ì§€ | ìˆ˜ë™ (ë¡œê·¸ í™•ì¸) | ìë™ (Sentinel ì—°ë™) |
| ê°­ ë³µêµ¬ ì‹œì‘ ì‹œê°„ | ì¥ ë§ˆê° í›„ | ì¥ì•  ë°œìƒ 5ë¶„ ì´ë‚´ |
| gatekeeper ì¥ì•  ëŒ€ì‘ | ì‹œìŠ¤í…œ ë§ˆë¹„ | Fallback to Local Limit |

---

## 3. êµ¬ì²´í™” ì„¸ì…˜ (6ì¸ í˜ë¥´ì†Œë‚˜ ì˜ê²¬)

### ğŸ‘” PM (Project Manager)
> "ë°ì´í„° ê°­ì€ ë°±í…ŒìŠ¤íŒ… ì‹ ë¢°ë„ì— ì§ê²°ë©ë‹ˆë‹¤. ìˆ˜ì§‘ê¸° ì¥ì•  ë°œìƒ ì‹œ 1ë¶„ ì´ë‚´ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤ê°€ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. SLA 99.9% ëª©í‘œ."

### ğŸ›ï¸ Architect
> "ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¥¼ ë„ì…í•´ì•¼ í•©ë‹ˆë‹¤. Redis Pub/Subë¡œ 'COLLECTOR_DOWN' ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ê³ , `recovery-worker`ê°€ êµ¬ë…í•˜ì—¬ ì¦‰ì‹œ ê°­ íƒì§€ ë° ë³µêµ¬ë¥¼ ì‹œì‘í•˜ëŠ” êµ¬ì¡°ê°€ ì í•©í•©ë‹ˆë‹¤."
```
Collector â”€â”€(ì¥ì• )â”€â”€> Sentinel â”€â”€(Pub)â”€â”€> Redis â”€â”€(Sub)â”€â”€> RecoveryWorker
                                                              â”‚
                                                              â–¼
                                                        ê°­ ë³µêµ¬ ì‹œì‘
```

### ğŸ”¬ Data Scientist
> "ê°­ ë³µêµ¬ ìš°ì„ ìˆœìœ„ëŠ” 'Volume ê±°ë˜ëŸ‰'ì´ ë†’ì€ ì¢…ëª©ë¶€í„° ì§„í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. 005930(ì‚¼ì„±ì „ì)ì˜ 1ë¶„ ê°­ì´ 000020ì˜ ê°­ë³´ë‹¤ ë¶„ì„ì ìœ¼ë¡œ ë” ì¤‘ìš”í•©ë‹ˆë‹¤."

### ğŸ—ï¸ Infra
> "Docker `depends_on` + `healthcheck`ë§Œìœ¼ë¡œëŠ” ëŸ°íƒ€ì„ ì¥ì• ë¥¼ ê°ì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. `Sentinel-agent`ê°€ ìˆ˜ì§‘ê¸° í•˜íŠ¸ë¹„íŠ¸ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , 60ì´ˆ ì´ìƒ ì‘ë‹µ ì—†ìœ¼ë©´ ìë™ ì¬ì‹œì‘ ëª…ë ¹ì„ Dockerì— ì „ë‹¬(SIGHUP)í•´ì•¼ í•©ë‹ˆë‹¤."
```yaml
# ì œì•ˆ: docker-compose.yml í™•ì¥
depends_on_healthy:
  collector: { condition: healthy, restart_on_unhealthy: true }
```

### ğŸ’» Developer
> "í˜„ì¬ `RecoveryOrchestrator`ëŠ” ìŠ¤ì¼€ì¤„ ê¸°ë°˜(cron)ì…ë‹ˆë‹¤. ì´ë²¤íŠ¸ ê¸°ë°˜ íŠ¸ë¦¬ê±°ë¥¼ ì¶”ê°€í•˜ë©´:
```python
async def on_collector_failure(event: CollectorDownEvent):
    gap_start = event.timestamp
    await recovery_orchestrator.run_hybrid_recovery(
        start_time=gap_start,
        priority='high'
    )
```
"

### ğŸ›¡ï¸ QA
> "ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤. CIì—ì„œ ê³ ì˜ë¡œ ìˆ˜ì§‘ê¸°ë¥¼ ì£½ì´ê³  ìë™ ë³µêµ¬ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” `Chaos Engineering` í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤."

---

## 4. ë¡œë“œë§µ ì—°ë™ ì‹œë‚˜ë¦¬ì˜¤

### Pillar ì—°ê²°
- **Pillar 2**: ê³ ì •ë°€ ë°ì´í„° ì¸ì… íŒŒì´í”„ë¼ì¸ (Data Integrity)
- **Pillar 3**: High Availability & Self-Healing

### êµ¬í˜„ ìš°ì„ ìˆœìœ„
| ìˆœì„œ | í•­ëª© | ë³µì¡ë„ | ì˜ì¡´ì„± |
|------|------|--------|--------|
| 1 | Sentinel â†’ Recovery ì´ë²¤íŠ¸ ì—°ë™ | ì¤‘ | Redis Pub/Sub |
| 2 | gatekeeper Fallback Mode | ë‚®ìŒ | rate_limiter.py |
| 3 | Volume ê¸°ë°˜ ê°­ ë³µêµ¬ ìš°ì„ ìˆœìœ„ | ì¤‘ | BackfillManager |
| 4 | Chaos Engineering í…ŒìŠ¤íŠ¸ | ë†’ìŒ | CI/CD |

### ìŠ¹ê²© ê·œì¹™
- ğŸ’¡ **Seed** â†’ ğŸŒ¿ **Sprouting**: Sentinel Pub/Sub PoC ì™„ì„± ì‹œ
- ğŸŒ¿ Sprouting â†’ ğŸŒ³ **Mature**: 1ì£¼ì¼ ì‹¤ì „ í…ŒìŠ¤íŠ¸ í›„
- ğŸŒ³ Mature â†’ **RFC-010**: Council ë§Œì¥ì¼ì¹˜ ì‹œ

---

## 5. í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### Docker ì¬ì‹œì‘ ì •ì±… í˜„í™©
```yaml
# í˜„ì¬ ì„¤ì •
recovery-worker:
  restart: always  # ë¬´ì¡°ê±´ ì¬ì‹œì‘, í•˜ì§€ë§Œ ì˜ì¡´ì„± ì¥ì• ëŠ” ì¸ì§€ ëª»í•¨

collector:
  restart: always  # ìˆ˜ì§‘ê¸° ì¥ì•  ì‹œ ìë™ ì¬ì‹œì‘, í•˜ì§€ë§Œ ê°­ì€ ë°œìƒí•¨
```

### ì œì•ˆ: Healthcheck ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ì¬ì‹œì‘
```yaml
# ê°œì„ ì•ˆ
recovery-worker:
  healthcheck:
    test: ["CMD", "python", "-c", "from src.api_gateway.rate_limiter import gatekeeper; ..."]
    interval: 30s
  depends_on:
    redis-gatekeeper:
      condition: service_healthy
    timescaledb:
      condition: service_healthy
```

---

**ì‘ì„±ì¼**: 2026-01-22
**ì‘ì„±ì**: User + AI Collaboration
**ë²„ì „**: v0.1 (Seed)
