services:
  # Mac (Apple Silicon) Compatibility & Local Dev Optimization

  redis:
    platform: linux/arm64
    ports:
      - "6379:6379"

  timescaledb:
    platform: linux/amd64 # Some images might not have arm64, but emulation works well for DBs
    ports:
      - "5432:5432"

  real-collector:
    platform: linux/arm64
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./src:/app/src # Hot Reload for Python Code
      - ./configs:/app/configs
    environment:
      - PYTHONUNBUFFERED=1
    profiles:
      - local

  api-server:
    platform: linux/arm64
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./src:/app/src # Hot Reload
    ports:
      - "8000:8000"
    command: uvicorn src.api.main:app --host 0.0.0.0 --port 8000 --reload
    profiles:
      - local

  dashboard-ui:
    platform: linux/arm64
    volumes:
      - ./src/web:/app/src/web # Hot Reload for Frontend
    profiles:
      - local

# Use '.env.local' via `make up-local`
